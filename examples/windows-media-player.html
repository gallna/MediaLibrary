<?php
use Kemer\MediaLibrary\Library;
use Kemer\MediaLibrary\Container;
use Kemer\MediaLibrary\Container\Genre\VideoGenre;
use Kemer\MediaLibrary\Container\Album\VideoAlbum;
use Kemer\MediaLibrary\Container\Actor\MovieActor;
use Kemer\MediaLibrary\Container\StorageFolder;
use Kemer\MediaLibrary\Container\PlaylistContainer;
use Kemer\MediaLibrary\Item\VideoItem;
use Kemer\MediaLibrary\Factory;
use Kemer\MediaLibrary\Factory\ItemFactory;
use Kemer\MediaLibrary\Factory\ContainerFactory;
use Kemer\MediaLibrary\Builder;
use Kemer\MediaLibrary\Filters;

include_once '../vendor/autoload.php';

$library = new Library();

/* add some content */
// add content from example folder using StorageFolderFactory
$memcache = new Memcache();
$cacheAvailable = $memcache->connect('127.0.0.1', '11211');
$builder = new Builder\GetID3Builder(new getID3(), $memcache);
$itemFactory = new ItemFactory\StorageItemFactory();
$storageFactory = new Factory\StorageFolderFactory($itemFactory, $builder);
$storageFolder = $storageFactory->createStorageFolder(__DIR__."/media");

$library->add($storageFolder);

$items = new ArrayIterator($library->getItems());

$videoFilter = new Filters\VideoFilter($items);
$videoLibrary = new Library();
$videoLibrary->set($videoFilter);

$musicFilter = new Filters\MusicFilter($items);
$musicLibrary = new Library();
$musicLibrary->set($musicFilter);




/* GenreFactory instance to create GenreContainerInterface containers from library */
$genreFactory = new ContainerFactory\GenreFactory();

/* GenreFactory instance to create GenreContainerInterface containers from library */
$personFactory = new ContainerFactory\PersonFactory();

/* GenreFactory instance to create MusicAlbum containers from library */
$albumFactory = new ContainerFactory\AlbumFactory();



/* Container for music containers and items */
$musicContainer = new Container(1, "Music");


$musicFolders = new Container(14, "Music/Folders");
$musicFolders->add($storageFolder);
//array_map([$musicFolders, "add"], $storageFolder->all());
//array_map([$musicFolders, "add"], iterator_to_array($musicFilter));
$musicContainer->add($musicFolders);


$allMusic = new Container(4, "Music/All Music");
array_map([$allMusic, "add"], iterator_to_array($musicFilter));
$musicContainer->add($allMusic);

/* Container for MusicGenre containers (optional) */
$musicGenreContainer  = new Container(5, "Music/Genre");
$genreFactory->createMusicGenre($musicLibrary, $musicGenreContainer);
$musicContainer->add($musicGenreContainer);

/* Container for MusicArtist containers (optional) */
$musicArtistContainer  = new Container(6, "Music/Artist");
$personFactory->createArtist($musicLibrary, $musicArtistContainer);
$musicContainer->add($musicArtistContainer);

/* Container for MusicAlbum containers (optional) */
$musicAlbumContainer  = new Container(7, "Music/Album");
$albumFactory->createMusicAlbum($musicLibrary, $musicAlbumContainer);
$musicContainer->add($musicAlbumContainer);

$musicContainer->add(new Container("F", "Music/Playlists"));



$musicContainer->add(new Container(101, "Music/Rating"));
$musicContainer->add(new Container(102, "Music/Rating/1 or more stars"));
$musicRating = new Container(103, "Music/Rating/2 or more stars");
array_map([$musicRating, "add"], iterator_to_array($musicFilter));
$musicContainer->add($musicRating);
$musicContainer->add(new Container(104, "Music/Rating/3 or more stars"));
$musicContainer->add(new Container(105, "Music/Rating/4 or more stars"));
$musicContainer->add(new Container(106, "Music/Rating/5 or more stars"));


/* Container for video containers and items */
$videoContainer = new Container(2, "Video");


$videoFolders = new Container(15, "Video/Folders");
array_map([$videoFolders, "add"], iterator_to_array($videoFilter));
$videoContainer->add($videoFolders);


$allVideo = new Container(8, "Video/All Video");
array_map([$allVideo, "add"], iterator_to_array($videoFilter));
$videoContainer->add($allVideo);

/* Container for VideoGenre containers (optional) */
$videoGenreContainer  = new Container(9, "Video/Genre");
$genreFactory->createVideoGenre($videoLibrary, $videoGenreContainer);
$videoContainer->add($videoGenreContainer);

/* Container for MovieActor containers (optional) */
$videoActorContainer  = new Container("A", "Video/Actor");
$personFactory->createActor($videoLibrary, $videoActorContainer);
$videoContainer->add($videoActorContainer);

$videoContainer->add(new Container("E", "Video/Series"));
$videoContainer->add(new Container(10, "Video/Playlists"));


$videoContainer->add(new Container(200, "Video/Rating"));
$videoContainer->add(new Container(201, "Video/Rating/1 or more stars"));
$videoRating = new Container(202, "Video/Rating/2 or more stars");
array_map([$videoRating, "add"], iterator_to_array($videoFilter));

$videoContainer->add($videoRating);
$videoContainer->add(new Container(203, "Video/Rating/3 or more stars"));
$videoContainer->add(new Container(204, "Video/Rating/4 or more stars"));
$videoContainer->add(new Container(205, "Video/Rating/5 or more stars"));

$picturesContainer = new Container(3, "Pictures");

$playlistsContainer = new Container(12, "Playlists");

/* Root Container for root items */
$root = new Container("0", "Content");
$root->setParentId(-1);
$root->add($videoContainer);
$root->add($musicContainer);
$root->add($picturesContainer);
$root->add($playlistsContainer);

$lib = new Library();
$lib->add($root);

$dom = new \DOMDocument("1.0");
$dom->formatOutput = true;
$dom->loadXML($lib->get("14")->asXML()->asXML());
echo "<pre>".htmlspecialchars($dom->saveXML())."</pre>";
